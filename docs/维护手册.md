# 维护手册（发布与版本管理）

本手册面向维护者，指导如何发布、打标签、让用户通过 pip+GitHub 稳定安装，以及常见维护动作。

---

## 1. 版本策略与标签
- 采用语义化版本：MAJOR.MINOR.PATCH（如 v1.0.0）
- 每次对外发布务必打新标签，已发布标签不要强推覆盖
- 推荐分支：main 作为发布分支

创建并推送标签（示例：v1.0.0）：
```powershell
git checkout main
git pull
# 将 <commit-sha> 替换为要发布的稳定提交
git tag -a v1.0.0 <commit-sha> -m "v1.0.0"
git push origin v1.0.0
```

若标签需更正：
```powershell
git push origin :refs/tags/v1.0.0
git tag -d v1.0.0
# 然后重新创建并推送
```

---

## 2. 给用户的安装方式（固定版本，强烈推荐）
- 从 GitHub + 标签安装：
```powershell
pip install "git+https://github.com/quant-king299/EasyXT.git@v1.0.0"
```
- 国内依赖镜像（源码仍从 GitHub 拉取）：
```powershell
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple "git+https://github.com/quant-king299/EasyXT.git@v1.0.0"
```
- 从提交哈希安装（应急或临时复现）：
```powershell
pip install "git+https://github.com/quant-king299/EasyXT.git@<commit-sha>"
```

升级到新版本：
```powershell
pip install -U "git+https://github.com/quant-king299/EasyXT.git@v1.0.1"
```

卸载：
```powershell
pip uninstall easy_xt
```

---

## 3. 雪球跟单用户前置条件与常见问题
- QMT 已安装并登录，且保持未锁屏
- 配置 `strategies/xueqiu_follow/config/unified_config.json` 中 `settings.account.qmt_path` 指向本机 `userdata` 或 `userdata_mini`
- 路径常见误写：`0MT`（应为 `QMT`）、`userdata mini`（应为 `userdata_mini`）
- 64 位 Python，终端权限与 QMT 一致（管理员/非管理员一致）
- 遇到连接错误码 -1：优先检查路径、权限、是否多实例占用、防火墙拦截、券商版本匹配

---

## 4. 发布前检查清单
- [ ] README 与文档中的安装命令已更新到新标签
- [ ] 改动点记录在 CHANGELOG 或 Release Notes
- [ ] 配置示例与默认值可用，避免指向作者本机路径
- [ ] 不将 xtquant/QMT 当作 pip 依赖声明（用户需自备）
- [ ] 关键依赖限定上下限，保证可复现
- [ ] 可选：在 GitHub Releases 创建发布说明

---

## 5. （可选）迁移到 PyPI 的注意点
- 使用 `pyproject.toml` 声明打包元数据；仅声明 PyPI 可安装的依赖
- 构建与上传：
```powershell
pip install build twine
python -m build
python -m twine upload dist/*
```
- README 长描述需正确渲染；继续在文档中强调 QMT/xtquant 前置条件

---

## 6. 故障应对
- 用户“例子能跑但启动类失败”：多半是交易通道前置条件不满足，按上面的 FAQ 引导自查
- 大面积安装失败：优先提供“固定标签”的安装命令；必要时临时回退到上一个稳定标签
- 连接 -1 统一排查：路径 → 登录 → 位数/权限 → 进程占用 → 防火墙 → 券商版本

---

## 7. 文档维护建议
- 主 README 面向用户，保持“安装、配置、启动、FAQ”简明权威
- 维护者流程集中在本手册，避免打扰普通用户
- 每次发版同步更新两个地方的版本号示例（README 与本手册）
