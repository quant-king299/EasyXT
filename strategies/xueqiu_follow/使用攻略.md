# 雪球跟单策略使用攻略（Windows 用户首启指南）

本攻略面向第一次使用用户，带你从环境准备到真实交易运行与监控，提供清晰步骤与风险提示。

重要声明：
- 雪球跟单策略已经上传 GitHub，欢迎下载使用并提出建议。
- 但是一定模拟盘测试学习，不要直接用于实盘。

重要声明：
- 项目已上传至 GitHub，欢迎下载使用并提出建议或改进意见。
- 请务必先在模拟盘环境中充分测试与学习，确认流程与风控有效后再考虑实盘。
- 禁止直接用于实盘，以免造成资金损失；真实交易需谨慎并自行承担风险。

## 项目地址与 GUI 相关结构

项目地址: https://github.com/quant-king299/EasyXT

项目结构（基于“雪球跟单策略”的实际情况）
```
miniqmt扩展/
├── strategies/xueqiu_follow/
│   ├── start_xueqiu_follow_easyxt.py   # 生产主入口（推荐）
│   ├── start_with_initial_sync.py      # 启动即调仓版（首次对齐）
│   ├── start_real_trading_easyxt.py    # 真实交易连通性自测
│   ├── startup_manager.py              # 守护式统一管理入口
│   ├── system_monitor.py               # 运行期轻量监控
│   ├── core/                           # 策略引擎/采集器/执行器/风控
│   ├── config/                         # 统一配置（unified_config.json 等）
│   ├── logs/                           # 策略运行日志
│   └── tests/                          # 单元/集成测试
├── gui_app/                            # 通用GUI（位于仓库根目录）
│   ├── main_window.py                  # 专业主窗口（策略管理与回测入口）
│   ├── trading_interface_simple.py     # 简洁交易界面
│   └── widgets/
│       └── backtest_widget.py          # 回测窗口组件
├── easy_xt/                            # 交易/数据子系统封装
└── reports/                            # 导出报表（如组合持仓导出）
```

## 1. 前置条件与准备

- 操作系统：Windows 10/11（PowerShell 7）
- Python：3.9+（建议 3.10+），并将 Python 加入 PATH
- QMT（券商的量化交易终端）：已安装并可正常登录
- EasyXT 模块：本项目已集成易用交易封装（easy_xt）
- 网络：可访问雪球（需配置有效 Cookie）
- 权限：以有权限的用户运行（建议普通账户而非管理员）

建议的软件：
- VSCode 或 PyCharm
- Git（可选）

## 2. 目录结构关键点

- strategies/xueqiu_follow/：主策略目录
  - config/：配置文件（unified_config.json、real_trading.json 等）
  - core/：策略引擎、采集器、执行器、风险管理等核心代码
  - tests/：pytest 测试用例，保证功能正确性
  - start_xueqiu_follow_easyxt.py：推荐主入口（生产）
  - start_with_initial_sync.py：启动即调仓版（高安全确认）
  - start_real_trading_easyxt.py：真实交易连通性演示/自测
  - startup_manager.py：统一启动与生命周期管理入口（守护式）
  - system_monitor.py：运行期轻量监控工具
  - update_config_for_easyxt.py：配置迁移与更新到 EasyXT
  - adjust_follow_ratio.py：交互式调整跟随比例

项目根目录：
- 启动雪球跟单.bat：一键启动批处理（已生成）

## 3. 安装依赖

在项目根目录打开 PowerShell：

```powershell
# 安装基础依赖（根据项目 requirements）
pip install -r requirements.txt

# 若需实时数据/监控相关
pip install -r requirements_realtime.txt

# 策略局部依赖（如有）
pip install -r strategies/xueqiu_follow/requirements.txt
```

如提示缺失 easy_xt 或 xtquant，请确保它们在项目的路径结构内或已安装到 Python 环境。

## 4. 配置准备

配置文件路径建议：
- 主配置：strategies/xueqiu_follow/config/unified_config.json
- 真实交易配置：strategies/xueqiu_follow/config/real_trading.json

必须项：
- settings.account.account_id：你的交易账户ID（如：39020958）
- settings.account.qmt_path：QMT 的 userdata 路径（例如：C:\同花顺QMT\userdata_mini）
- xueqiu_settings.cookie：雪球有效 Cookie，用于采集组合持仓与调仓历史
- portfolios：跟单组合列表（包含 code/symbol、follow_ratio、enabled 等字段）

首次迁移或修复配置，可运行配置更新工具：
```powershell
python strategies\xueqiu_follow\update_config_for_easyxt.py
```
该工具会尝试自动/手动检测 QMT 路径，写入 EasyXT 相关配置并验证。

## 5. 启动方式选择

你可以根据场景选择不同启动脚本：

- 生产主入口（推荐）
  - 脚本：start_xueqiu_follow_easyxt.py
  - 适用：日常生产运行，含环境自检（依赖检查/QMT检测/连接测试）、容错（历史调仓兜底重建）、启动前同步账户持仓（smart_follow）
  - 启动：
    ```powershell
    python strategies\xueqiu_follow\start_xueqiu_follow_easyxt.py
    ```
  - 或双击根目录的“启动雪球跟单.bat”

- 初始同步版（启动即调仓）
  - 脚本：start_with_initial_sync.py
  - 适用：首次对齐实盘持仓；要求三重安全确认，启动后立即根据雪球组合当前持仓进行调仓
  - 启动：
    ```powershell
    python strategies\xueqiu_follow\start_with_initial_sync.py
    ```

- 守护式统一管理入口
  - 脚本：startup_manager.py
  - 作用：统一启动流程（预检查→初始化→启动→主循环→健康检查→优雅关闭），适合常驻服务
  - 启动：
    ```powershell
    python strategies\xueqiu_follow\startup_manager.py
    ```

- 真实交易连通性自测
  - 脚本：start_real_trading_easyxt.py
  - 作用：验证 EasyXT 连接与账户查询，带三重确认；不含完整自动跟单逻辑
  - 启动：
    ```powershell
    python strategies\xueqiu_follow\start_real_trading_easyxt.py
    ```

## 6. 安全提示与确认

真实交易前务必确认：
- 账户ID与 QMT 路径有效，QMT 已登录且可下单
- 雪球 Cookie 有效，组合代码正确
- follow_ratio 合理（0–1），max_position、max_single_amount 等风控参数设置妥当

部分入口会进行多重安全确认（如初始同步版与真实交易版），请按照提示输入 YES / SYNC / START 或对应关键字。

## 7. 运行前快速自检

- 依赖检测与 QMT 检测：
  - 运行生产主入口会自动自检；也可单独运行工具或测试脚本
- 连接测试：
  ```powershell
  # 若项目内提供 test_qmt_connection.py（或通过主入口的连接测试）
  python strategies\xueqiu_follow\start_xueqiu_follow_easyxt.py
  ```
  按日志提示确认是否“EasyXT 连接成功”“账户添加成功”“资产查询成功”。

- 单元/集成测试：
  ```powershell
  python -m pytest strategies/xueqiu_follow/tests/ -v
  python -m pytest strategies/xueqiu_follow/tests/test_integration.py -v
  ```

## 8. 运行中监控与日志

- 轻量监控仪表：本地控制台趋势与告警
  ```powershell
  python strategies\xueqiu_follow\system_monitor.py
  ```
  显示 CPU/内存/网络趋势、当天日志中的 ERROR/WARNING/交易成功次数、启用组合与紧急停止状态。

- 日志位置：
  - strategies/xueqiu_follow/logs/ 下的当日日志（不同入口脚本会生成不同前缀）
  - 监控、启动/关闭信息也会写入相应日志文件

- 紧急停止：
  - 可通过配置中的 global setting（emergency_stop）触发守护式入口的优雅关闭

## 9. 常见配置项说明

- portfolios 列表结构（统一配置 unified_config.json 示例）：
  - code / symbol：组合代码（如 ZH2863835）
  - follow_ratio：跟随比例（0.02 表示 2%）
  - enabled：是否启用
  - max_position：单组合最大仓位上限（元）
  - url：组合网址（可选）

- settings.trading：
  - trade_mode：real（真实）或 simulation（模拟）
  - max_single_amount：单笔上限
  - min_trade_amount：最小交易额度

- xueqiu_settings：
  - cookie：雪球 Cookie，建议定期更新

## 10. 进阶功能

- 初始同步调仓（首次对齐）
  - 入口：start_with_initial_sync.py
  - 流程：三重确认 → 加载组合 → 获取当前持仓 → 立即执行调仓 → 持续监控

- 配置迁移与更新到 EasyXT
  - 入口：update_config_for_easyxt.py
  - 功能：备份旧配置 → 自动/手动检测 QMT → 写入 EasyXT 会话与交易配置 → 验证并保存

- 跟随比例调整（交互式）
  - 入口：adjust_follow_ratio.py
  - 功能：读取 real_trading.json → 展示建议比例 → 写回 follow_ratio
  - 建议：后续优化为参数化与读取统一配置；或直接在配置文件中手动设定

- 持仓导出到 Excel（在初始同步版中内置）
  - 由配置开关控制（settings.export_holdings/导出持仓），导出至项目 reports 目录

## 11. 常见问题与排查

- QMT 路径无效/连接失败
  - 检查 settings.account.qmt_path 是否指向 userdata_mini
  - 确认 QMT 已登录、网络正常
  - 使用 update_config_for_easyxt.py 重新检测与写入

- 雪球数据获取为空/过少
  - Cookie 可能失效，更新 xueqiu_settings.cookie
  - 生产主入口含兜底：历史调仓回放/完整快照重建；观察日志中的“兜底解析”“重放解析”提示

- 跟随比例无效或被拒
  - ConfigManager 会校验 follow_ratio ∈ [0, 1]，确保字段类型与范围正确
  - 检查 portfolios 结构（字典/列表）与字段命名是否匹配

- pytest 报错
  - 确保已安装 pytest 与 pytest-asyncio
  - 使用命令：python -m pytest strategies/xueqiu_follow/tests/ -v

## 12. 一键批处理启动（已生成）

- 根目录“启动雪球跟单.bat”
  - 功能：切换到 strategies\xueqiu_follow 并运行 start_xueqiu_follow_easyxt.py
  - 若需改为“初始同步版”，可另生成“启动雪球跟单_初始同步.bat”，内容将指向 start_with_initial_sync.py

## 13. 最佳实践建议

- 首次部署：
  1) 安装依赖 → 2) 运行 update_config_for_easyxt.py → 3) 配置 unified_config.json/real_trading.json → 4) 运行 pytest → 5) 执行“真实交易连通性自测” → 6) 生产主入口启动
- 生产运行：
  - 推荐 start_xueqiu_follow_easyxt.py 或 startup_manager.py（守护式）
  - 配合 system_monitor.py 观察负载与异常
- 风险控制：
  - 严格设置跟随比例、单笔限额、最大仓位等
  - 真实交易前进行多重确认与小额试单

---

如需将本攻略渲染为 HTML，可直接用 Markdown 预览；若你希望生成图文并茂的网页版或在 GUI 中嵌入帮助页，我可以继续为你制作。