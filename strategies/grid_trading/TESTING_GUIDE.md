# 国债ETF高频网格交易 - 测试指南

## 📁 文件清单

```
strategies/grid_trading/
├── 高频分时网格策略.py         # 核心策略实现
├── test_bond_etf_grid.py       # 测试脚本（推荐）
├── config_wizard.py             # 配置向导
├── bond_etf_config.json         # 配置文件
├── 启动国债ETF网格测试.bat      # 快速启动
├── 配置向导.bat                 # 配置工具
├── QUICK_START.md              # 快速开始指南
└── README.md                   # 详细文档
```

## 🚀 快速开始（3种方式）

### 方式1：使用配置向导（推荐新手）

**步骤**：
1. 双击 `配置向导.bat`
2. 按提示选择参数（保守/稳健/激进）
3. 输入账户ID（可选）
4. 选择测试/实盘模式
5. 完成后运行 `启动国债ETF网格测试.bat`

**优点**：
- ✅ 无需手动编辑配置文件
- ✅ 提供预设参数模板
- ✅ 自动保存配置

### 方式2：直接运行测试脚本

**步骤**：
1. 编辑 `bond_etf_config.json`，修改参数
2. 双击 `启动国债ETF网格测试.bat`
3. 或在命令行运行：`python test_bond_etf_grid.py`

**优点**：
- ✅ 灵活配置所有参数
- ✅ 适合有经验的用户

### 方式3：编程调用

```python
from strategies.grid_trading.test_bond_etf_grid import 国债ETF网格测试器

# 创建测试器
tester = 国债ETF网格测试器('my_config.json')

# 运行测试
tester.run_test()
```

## 📊 运行示例

### 启动输出

```
================================================================================
                    国债ETF高频网格测试
================================================================================
测试时间: 2025-01-22 10:30:00
================================================================================

📋 当前配置:
--------------------------------------------------------------------------------
账户ID: **********
账户类型: STOCK
股票池: ['511090.SH', '511130.SH']
网格阈值: 买入-0.15% / 卖出0.15%
交易数量: 100股/次
最大持仓: 500股
价格模式: 最新价
测试模式: 否（实盘）
--------------------------------------------------------------------------------

⏳ 正在初始化策略...
✅ 策略初始化成功

📊 市场状态:
--------------------------------------------------------------------------------
511090.SH (30年国债ETF)
  最新价: 102.350  涨跌: +0.12%  持仓: 无持仓
  买一: 102.350  卖一: 102.355
  时间: 10:30:05

511130.SH (30年国债ETF)
  最新价: 101.880  涨跌: -0.05%  持仓: 200股 (可用200股)
  买一: 101.880  卖一: 101.885
  时间: 10:30:05
--------------------------------------------------------------------------------

🚀 开始运行测试...
提示: 按 Ctrl+C 停止测试

================================================================================
```

### 实时监控

```
[2025-01-22 10:31:23] 511130.SH 当前价:101.750, 上次触发:101.880, 涨跌:-0.13% -> 无交易信号
[2025-01-22 10:31:26] 511130.SH 当前价:101.720, 上次触发:101.880, 涨跌:-0.16% <= -0.15% -> 买入信号
[2025-01-22 10:31:26] ✅ 买入成功: 511130.SH 100股 @101.720
```

### 统计输出

```
📈 交易统计:
--------------------------------------------------------------------------------
运行时长: 00:15:30
运行次数: 8
买入次数: 4
卖出次数: 4
总交易: 8次
预估收益: 48.50元
预估手续费: 0.08元
净收益: 48.42元
--------------------------------------------------------------------------------
```

## ⚙️ 配置说明

### 最小配置（测试）

```json
{
  "账户ID": "",
  "是否测试": true,
  "股票池": ["511090.SH"],
  "买入涨跌幅": -0.15,
  "卖出涨跌幅": 0.15
}
```

### 推荐配置（小仓位实盘）

```json
{
  "账户ID": "39020958",
  "账户类型": "STOCK",
  "股票池": ["511090.SH", "511130.SH"],
  "买入涨跌幅": -0.15,
  "卖出涨跌幅": 0.15,
  "单次交易数量": 100,
  "最大持仓数量": 500,
  "价格模式": 5,
  "交易开始时间": 9,
  "交易结束时间": 15,
  "是否测试": false
}
```

### 高级配置（大仓位）

```json
{
  "账户ID": "39020958",
  "账户类型": "STOCK",
  "股票池": ["511090.SH", "511130.SH", "511280.SH"],
  "股票名称": ["30年国债", "30年国债", "5年国债"],
  "买入涨跌幅": -0.12,
  "卖出涨跌幅": 0.12,
  "单次交易数量": 300,
  "最大持仓数量": 1500,
  "价格模式": 5,
  "交易开始时间": 9,
  "交易结束时间": 15,
  "是否参加集合竞价": false,
  "是否测试": false,
  "监控间隔": 2,
  "统计周期": 30
}
```

## 📈 性能监控

### 关键指标

**运行指标**：
- 运行时长
- 运行次数
- 买入/卖出次数

**收益指标**：
- 预估总收益
- 手续费
- 净收益

**市场指标**：
- 最新价格
- 涨跌幅
- 当前持仓

### 日志文件

交易日志自动保存在 `logs/` 目录：
```
logs/
├── bond_etf_grid_20250122.json  # 当天的交易记录
└── bond_etf_grid_20250121.json  # 前一天的交易记录
```

日志格式：
```json
[
  {
    "证券代码": "511130.SH",
    "触发时间": "2025-01-22 10:31:26",
    "交易类型": "买",
    "交易数量": 100,
    "持限制": 500,
    "触发价格": 101.72
  }
]
```

## 🔧 常见操作

### 1. 修改参数

**方法A**：使用配置向导
```bash
双击 "配置向导.bat"
```

**方法B**：手动编辑
```bash
编辑 "bond_etf_config.json"
保存后重启测试脚本
```

### 2. 切换测试/实盘

```json
// 测试模式（不实际下单）
"是否测试": true

// 实盘模式（真实交易）
"是否测试": false
```

⚠️ **实盘前务必**：
1. 先在测试模式运行1-2天
2. 确认参数设置合理
3. 小仓位测试（100股/次）
4. 观察交易是否符合预期

### 3. 查看历史记录

```python
import pandas as pd

# 读取交易日志
df = pd.read_json('logs/bond_etf_grid_20250122.json')

# 查看所有交易
print(df)

# 统计买卖次数
print(df['交易类型'].value_counts())

# 计算收益
buy_df = df[df['交易类型'] == '买']
sell_df = df[df['交易类型'] == '卖']
print(f"买入次数: {len(buy_df)}")
print(f"卖出次数: {len(sell_df)}")
```

### 4. 暂停和恢复

**暂停**：按 `Ctrl+C` 停止测试

**恢复**：
- 策略会自动从上次触发价格继续
- 不会丢失交易状态
- 可以随时重启

### 5. 重置策略

如果要清空历史记录重新开始：

```python
# 方法1：删除日志文件
import os
os.remove('logs/bond_etf_grid_20250122.json')

# 方法2：使用配置向导
# 选择修改账户ID会重置日志
```

## ⚠️ 注意事项

### 首次运行

1. ✅ 使用测试模式运行
2. ✅ 观察日志输出，检查逻辑
3. ✅ 确认行情数据正常
4. ✅ 验证触发条件合理

### 实盘运行

1. ✅ 先用小仓位（100股/次）
2. ✅ 观察至少1个完整交易日
3. ✅ 监控资金使用情况
4. ✅ 检查交易是否符合预期

### 长期运行

1. ✅ 定期查看交易日志（每周）
2. ✅ 统计收益情况（每月）
3. ✅ 根据市场波动调整参数
4. ✅ 避开重大消息期

### 风险控制

1. ❌ 不要满仓运行
2. ❌ 不要使用借贷资金
3. ❌ 不要设置过小的网格间距
4. ❌ 不要在单边行情强行运行

## 📞 技术支持

- **查看文档**：`QUICK_START.md` - 快速开始指南
- **详细说明**：`README.md` - 完整文档
- **配置问题**：使用 `配置向导.bat` 辅助配置
- **运行问题**：检查日志文件，查看错误信息

## 🎓 下一步

1. **测试运行**：先用测试模式熟悉流程
2. **小仓位实盘**：100股/次开始实盘测试
3. **参数优化**：根据实际表现调整参数
4. **扩大规模**：确认稳定后逐步加大仓位

---

**祝您交易顺利！** 📈
